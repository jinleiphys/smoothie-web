<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FAQ - SMOOTHIE</title>
    <meta name="description" content="Frequently Asked Questions about SMOOTHIE - Scattering Model of Optical Operator Theory for Ichimura-Austern-Vincent Equations">
    <meta name="keywords" content="SMOOTHIE FAQ, quantum scattering questions, nuclear physics help">
    <meta name="author" content="SMOOTHIE Development Team">
    
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://fonts.googleapis.com https://fonts.gstatic.com https://www.googletagmanager.com; script-src 'self' 'unsafe-inline' https://www.googletagmanager.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; img-src 'self' data:; connect-src 'self' https://api.github.com https://www.google-analytics.com https://www.googletagmanager.com;">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://smoothie.fewbody.com/faq.html">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="FAQ - SMOOTHIE">
    <meta property="og:description" content="Get answers to frequently asked questions about SMOOTHIE quantum scattering model">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary">
    <meta property="twitter:title" content="FAQ - SMOOTHIE">
    <meta property="twitter:description" content="Get answers to frequently asked questions about SMOOTHIE quantum scattering model">
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-J60NE88WR1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-J60NE88WR1');
    </script>
    
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <a href="#main-content" class="skip-navigation">Skip to main content</a>
    
    <div class="app-container">
        <button class="mobile-menu-toggle" aria-label="Toggle menu">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
        </button>
        
        <div class="sidebar-overlay"></div>
        
        <nav class="sidebar" role="navigation" aria-label="Main navigation">
            <div class="sidebar-header">
                <h1 class="logo">SMOOTHIE</h1>
                <div class="logo-subtitle">Scattering Model of Optical Operator Theory for Ichimura-Austern-Vincent Equations</div>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html" class="nav-link">Home</a></li>
                <li><a href="story.html" class="nav-link">Birth of SMOOTHIE</a></li>
                <li><a href="papers.html" class="nav-link">Related Papers</a></li>
                <li><a href="formulas.html" class="nav-link">Theoretical Framework</a></li>
                <li><a href="downloads.html" class="nav-link">Downloads</a></li>
                <li><a href="examples.html" class="nav-link">Input Examples</a></li>
                <li><a href="programs.html" class="nav-link">Related Programs</a></li>
                <li><a href="generator.html" class="nav-link">Input File Generator</a></li>
                <li><a href="code.html" class="nav-link">Code & Installation</a></li>
                <li><a href="contact.html" class="nav-link">Contact</a></li>
                <li><a href="faq.html" class="nav-link active">FAQ</a></li>
            </ul>
        </nav>

        <main class="main-content" id="main-content" role="main">
            <nav aria-label="Breadcrumb" class="breadcrumb">
                <ol>
                    <li><a href="index.html">Home</a></li>
                    <li>FAQ</li>
                </ol>
            </nav>
            
            <div class="page-header">
                <h1>Frequently Asked Questions</h1>
                <p>Get answers to common questions about SMOOTHIE. Can't find what you're looking for? Ask a new question below!</p>
            </div>

            <div class="faq-container">
                <div class="faq-actions">
                    <button class="btn-primary" onclick="showQuestionForm()">Ask a Question</button>
                    <button class="btn-secondary" onclick="loadFAQs()">Refresh FAQs</button>
                </div>

                <div class="question-form-container" id="questionForm" style="display: none;">
                    <div class="question-form">
                        <h3>Ask a New Question</h3>
                        <form id="faqForm" onsubmit="submitQuestion(event)">
                            <div class="form-group">
                                <label for="questionTitle">Question Title:</label>
                                <input type="text" id="questionTitle" name="title" required 
                                       placeholder="Brief summary of your question">
                            </div>
                            <div class="form-group">
                                <label for="questionBody">Question Details:</label>
                                <textarea id="questionBody" name="body" required rows="6"
                                         placeholder="Please provide detailed information about your question, including any error messages, input files, or specific scenarios you're encountering."></textarea>
                            </div>
                            <div class="form-group">
                                <label for="questionEmail">Your Email (optional):</label>
                                <input type="email" id="questionEmail" name="email" 
                                       placeholder="your.email@example.com (for follow-up notifications)">
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn-primary">Submit Question</button>
                                <button type="button" class="btn-secondary" onclick="hideQuestionForm()">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="loading-spinner" id="loadingSpinner" style="display: none;">
                    <div class="spinner"></div>
                    <p>Loading FAQs...</p>
                </div>

                <div class="faq-list" id="faqList">
                    <div class="faq-item">
                        <h3 class="faq-question">How do I install SMOOTHIE?</h3>
                        <div class="faq-answer">
                            <p>SMOOTHIE can be installed by downloading the source code from the <a href="downloads.html">Downloads</a> page and compiling it using a Modern Fortran compiler. Detailed installation instructions are available on the <a href="code.html">Code & Installation</a> page.</p>
                        </div>
                    </div>

                    <div class="faq-item">
                        <h3 class="faq-question">What are the system requirements for running SMOOTHIE?</h3>
                        <div class="faq-answer">
                            <p>SMOOTHIE requires:</p>
                            <ul>
                                <li>A Modern Fortran compiler (gfortran, ifort, etc.)</li>
                                <li>Linux or Windows operating system</li>
                                <li>At least 4GB of RAM for typical calculations</li>
                                <li>Sufficient disk space for input/output files</li>
                            </ul>
                        </div>
                    </div>

                    <div class="faq-item">
                        <h3 class="faq-question">How do I create input files for SMOOTHIE?</h3>
                        <div class="faq-answer">
                            <p>You can create input files manually by following the format described in the documentation, or use our <a href="generator.html">Input File Generator</a> for a guided approach. Example input files are available on the <a href="examples.html">Input Examples</a> page.</p>
                        </div>
                    </div>

                    <div class="faq-item">
                        <h3 class="faq-question">What should I cite when using SMOOTHIE in my research?</h3>
                        <div class="faq-answer">
                            <p>Please cite the relevant papers listed on our <a href="index.html#citation">home page</a>. The main references include the foundational work by Lei & Moro (2015), the theoretical framework by Lei (2018), and the R-matrix method by Lei & Descouvemont (2020).</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <button class="back-to-top" id="backToTop" aria-label="Back to top">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 15l-6-6-6 6"/>
        </svg>
    </button>

    <script src="script.js"></script>
    <script>
        const GITHUB_REPO = 'jinleiphys/smoothie-web';
        const FAQ_LABEL = 'faq';

        function showQuestionForm() {
            document.getElementById('questionForm').style.display = 'block';
            document.getElementById('questionTitle').focus();
        }

        function hideQuestionForm() {
            document.getElementById('questionForm').style.display = 'none';
            document.getElementById('faqForm').reset();
        }

        async function submitQuestion(event) {
            event.preventDefault();

            const title = document.getElementById('questionTitle').value;
            const body = document.getElementById('questionBody').value;
            const email = document.getElementById('questionEmail').value;

            let issueBody = body;
            if (email) {
                issueBody += `\n\n---\n**Contact:** ${email}`;
            }

            const githubUrl = `https://github.com/${GITHUB_REPO}/issues/new?` +
                `title=${encodeURIComponent(title)}&` +
                `body=${encodeURIComponent(issueBody)}&` +
                `labels=${FAQ_LABEL}`;

            hideQuestionForm();

            alert('Thank you for your question! You will be redirected to GitHub to complete the submission. The question will appear in the FAQ once it has been answered.');

            window.open(githubUrl, '_blank');

            // Auto-refresh after 5 seconds to check for new questions
            setTimeout(loadFAQs, 5000);
        }

        async function loadFAQs() {
            const spinner = document.getElementById('loadingSpinner');
            const faqList = document.getElementById('faqList');

            spinner.style.display = 'block';

            try {
                // Fetch all issues (both open and closed)
                const response = await fetch(`https://api.github.com/repos/${GITHUB_REPO}/issues?state=all&per_page=100`);
                const allIssues = await response.json();

                // Filter for FAQ-related issues - look for:
                // 1. Issues with 'faq' or 'question' labels
                // 2. Issues with question-related content
                // 3. Issues with contact email (from the FAQ form)
                const issues = allIssues.filter(issue => {
                    // Skip pull requests
                    if (issue.pull_request) return false;

                    const title = issue.title.toLowerCase();
                    const body = (issue.body || '').toLowerCase();

                    // Check for FAQ-related labels
                    const hasRelevantLabel = issue.labels.some(label =>
                        ['faq', 'question', 'help wanted'].includes(label.name.toLowerCase())
                    );

                    // Check for question indicators
                    const hasQuestionIndicators =
                        title.includes('?') ||
                        title.includes('how') ||
                        title.includes('what') ||
                        title.includes('why') ||
                        title.includes('when') ||
                        title.includes('where') ||
                        title.includes('can i') ||
                        title.includes('should i') ||
                        body.includes('question') ||
                        body.includes('**contact:**'); // From FAQ form submission

                    return hasRelevantLabel || hasQuestionIndicators;
                });
                
                if (issues && issues.length > 0) {
                    // Get the default FAQ content first
                    const defaultFAQs = document.getElementById('faqList').innerHTML;

                    // Fetch comments for each issue to get the actual answers
                    const dynamicFAQs = await Promise.all(issues.map(async (issue) => {
                        const question = issue.title;
                        const isOpen = issue.state === 'open';
                        let answer = isOpen ?
                            'This question is currently being reviewed. Please check back soon for an answer.' :
                            'This question has been answered.';

                        // Fetch comments to get the actual answer
                        if (issue.comments > 0) {
                            try {
                                const commentsResponse = await fetch(issue.comments_url);
                                const comments = await commentsResponse.json();

                                if (comments && comments.length > 0) {
                                    // Get the first comment as the answer (usually from the maintainer)
                                    const firstComment = comments[0];
                                    answer = firstComment.body || 'No answer provided yet.';

                                    // Convert markdown-style formatting to HTML
                                    answer = formatMarkdownToHtml(answer);
                                }
                            } catch (commentError) {
                                console.error('Error fetching comments:', commentError);
                                answer = 'Error loading answer. Please check the GitHub discussion.';
                            }
                        }

                        const statusBadge = isOpen ?
                            '<span style="display: inline-block; background: #ffa500; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.75em; margin-left: 8px;">Pending</span>' :
                            '<span style="display: inline-block; background: #28a745; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.75em; margin-left: 8px;">Answered</span>';

                        return `
                            <div class="faq-item dynamic-faq ${isOpen ? 'faq-pending' : 'faq-answered'}">
                                <h3 class="faq-question">${escapeHtml(question)}${statusBadge}</h3>
                                <div class="faq-answer">
                                    <div class="faq-answer-content">${answer}</div>
                                    <div class="faq-meta">
                                        <small>Asked on: ${new Date(issue.created_at).toLocaleDateString()}</small>
                                        ${issue.closed_at && !isOpen ? `<small> • Answered on: ${new Date(issue.closed_at).toLocaleDateString()}</small>` : ''}
                                        <a href="${issue.html_url}" target="_blank" class="faq-link">View full discussion →</a>
                                    </div>
                                </div>
                            </div>
                        `;
                    }));

                    // Add dynamic FAQs after default ones
                    faqList.innerHTML = defaultFAQs + dynamicFAQs.join('');

                    // Reinitialize click handlers for all FAQ items
                    initializeFAQHandlers();
                } else {
                    console.log('No FAQ issues found, keeping default content');
                }
            } catch (error) {
                console.error('Error loading FAQs:', error);
            } finally {
                spinner.style.display = 'none';
            }
        }

        function formatMarkdownToHtml(text) {
            // Basic markdown to HTML conversion
            return text
                // Convert bold **text** to <strong>text</strong>
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                // Convert italic *text* to <em>text</em>
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                // Convert code `text` to <code>text</code>
                .replace(/`([^`]+)`/g, '<code>$1</code>')
                // Convert links [text](url) to <a href="url">text</a>
                .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>')
                // Convert line breaks to <br>
                .replace(/\n/g, '<br>')
                // Convert code blocks ```text``` to <pre><code>text</code></pre>
                .replace(/```([^`]+)```/g, '<pre><code>$1</code></pre>')
                // Convert headers # text to <h4>text</h4>
                .replace(/^# (.+)$/gm, '<h4>$1</h4>')
                .replace(/^## (.+)$/gm, '<h5>$1</h5>')
                .replace(/^### (.+)$/gm, '<h6>$1</h6>');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function initializeFAQHandlers() {
            const faqItems = document.querySelectorAll('.faq-item');
            faqItems.forEach(item => {
                const question = item.querySelector('.faq-question');
                // Remove existing listeners to avoid duplicates
                question.replaceWith(question.cloneNode(true));
                const newQuestion = item.querySelector('.faq-question');
                newQuestion.addEventListener('click', function() {
                    item.classList.toggle('active');
                });
            });
        }

        // Auto-refresh functionality
        function startAutoRefresh() {
            // Refresh every 2 minutes
            setInterval(loadFAQs, 120000);
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Initialize FAQ handlers for default content
            initializeFAQHandlers();
            
            // Load dynamic FAQs on page load
            loadFAQs();
            
            // Start auto-refresh
            startAutoRefresh();
        });
    </script>
</body>
</html>